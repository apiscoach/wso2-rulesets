rules:
  # Validate that transport array contains only HTTPS
  wso2-api-transport-https-only:
    description: "WSO2 API transport must be HTTPS only for security"
    given: "$.data.transport.*"
    severity: error
    then:
      function: pattern
      functionOptions:
        match: "^https$"

  # Validate that security scheme array contains only OAuth2
  wso2-api-security-oauth2-only:
    description: "WSO2 API security must use OAuth2 only"
    given: "$.data.securityScheme.*"
    severity: error
    then:
      function: pattern
      functionOptions:
        match: "^oauth2$"

  # Validate transport field is present
  wso2-api-transport-required:
    description: "Transport configuration is required"
    given: "$.data"
    severity: error
    then:
      field: "transport"
      function: truthy

  # Validate security scheme field is present
  wso2-api-security-scheme-required:
    description: "Security scheme configuration is required"
    given: "$.data"
    severity: error
    then:
      field: "securityScheme"
      function: truthy

  # Warning for insecure transport protocols
  wso2-api-no-insecure-transport:
    description: "Insecure transport protocols (http, ftp) are not allowed"
    given: "$.data.transport.*"
    severity: error
    then:
      function: pattern
      functionOptions:
        notMatch: "^(http|ftp)$"

  # Warning for weak security schemes
  wso2-api-no-weak-security:
    description: "Weak security schemes (basic, apikey) should not be used"
    given: "$.data.securityScheme.*"
    severity: warn
    then:
      function: pattern
      functionOptions:
        notMatch: "^(basic|apikey|none)$"

  # Validate API endpoints use HTTPS
  wso2-api-endpoint-https-only:
    description: "All API endpoints must use HTTPS protocol"
    given: "$.data.endpointConfig.production_endpoints.url"
    severity: error
    then:
      function: pattern
      functionOptions:
        match: "^https://"

  # Validate sandbox endpoints use HTTPS
  wso2-api-sandbox-endpoint-https-only:
    description: "All sandbox endpoints must use HTTPS protocol"
    given: "$.data.endpointConfig.sandbox_endpoints.url"
    severity: error
    then:
      function: pattern
      functionOptions:
        match: "^https://"